<?xml version="1.0" encoding="UTF-8"?>

<x:description
    schematron="../../rules/poam.sch"
    xmlns:doc="https://fedramp.gov/oscal/fedramp-automation-documentation"
    xmlns:sch="http://purl.oclc.org/dsdl/schematron"
    xmlns:x="http://www.jenitennison.com/xslt/xspec">

    <x:scenario
        label="sanity-checks">

        <x:scenario
            label="when the root element">

            <x:scenario
                label="is in OSCAL 1.0 namespace">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0" />
                </x:context>
                <x:expect-not-assert
                    id="document-is-OSCAL-document"
                    label="that is correct" />
            </x:scenario>

            <x:scenario
                label="is not in OSCAL 1.0 namespace">
                <x:context>
                    <plan-of-action-and-milestones>
                        <!-- note lack of namespace -->
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="document-is-OSCAL-document"
                    label="that is an error" />
            </x:scenario>

            <x:scenario
                label="is plan-of-action-and-milestones">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0" />
                </x:context>
                <x:expect-not-assert
                    id="document-is-plan-of-action-and-milestones"
                    label="that is correct" />
            </x:scenario>

            <x:scenario
                label="is not a plan-of-action-and-milestones">
                <x:context>
                    <not-a-plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <!-- not the expected element -->
                    </not-a-plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="document-is-plan-of-action-and-milestones"
                    label="that is an error" />
            </x:scenario>

        </x:scenario>

    </x:scenario>

    <x:scenario
        label="import-ssp">

        <x:context>
            <plan-of-action-and-milestones
                xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                <import-ssp
                    href="#bf974aa0-d662-4aef-a7a5-8f4cce398746" />
                <back-matter>
                    <resource
                        uuid="bf974aa0-d662-4aef-a7a5-8f4cce398746">
                        <title>System Security Plan</title>
                        <prop
                            name="type"
                            value="system-security-plan" />
                        <rlink
                            href="../../../../dist/content/templates/ssp/xml/FedRAMP-SSP-OSCAL-Template.xml"
                            media-type="text/xml" />
                    </resource>
                </back-matter>
            </plan-of-action-and-milestones>
        </x:context>


        <x:scenario
            label="when the import-ssp element">

            <x:scenario
                label="is present">
                <x:expect-not-assert
                    id="has-import-ssp"
                    label="that is correct" />
            </x:scenario>

            <x:scenario
                label="is absent">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <!-- missing import-ssp -->
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="has-import-ssp"
                    label="that is an error" />
            </x:scenario>

            <x:scenario
                label="has an href attribute">
                <x:expect-not-assert
                    id="has-import-ssp-href"
                    label="that is correct" />
            </x:scenario>

            <x:scenario
                label="lacks an href attribute">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <import-ssp /><!-- missing href -->
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="has-import-ssp-href"
                    label="that is an error" />
            </x:scenario>

        </x:scenario>

        <x:scenario
            label="when the import-ssp has a relative href">
            <x:scenario
                label="which refers to a resource">
                <x:expect-not-assert
                    id="has-import-ssp-internal-href"
                    label="that is correct" />
            </x:scenario>
            <x:scenario
                label="which does not refer to a resource">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <import-ssp
                            href="#bf974aa0-d662-4aef-a7a5-8f4cce398746" />
                        <back-matter>
                            <!-- missing resource -->
                        </back-matter>
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="has-import-ssp-internal-href"
                    label="that is an error" />
            </x:scenario>
        </x:scenario>

        <x:scenario
            label="when the import-ssp has an external href">
            <x:scenario
                label="which is available"
                pending="XSpec problem resolution">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <import-ssp
                            href="../../../../dist/content/templates/ssp/xml/FedRAMP-SSP-OSCAL-Template.xml" />
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-not-assert
                    id="has-import-ssp-external-href"
                    label="that is correct" />
            </x:scenario>
            <x:scenario
                label="which is not available">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <import-ssp
                            href="file:x" />
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="has-import-ssp-external-href"
                    label="that is an error" />
            </x:scenario>
        </x:scenario>

        <x:scenario
            label="when the import-ssp has a relative href">
            <x:scenario
                label="and the SSP is declared as a back-matter resource">
                <x:expect-not-assert
                    id="has-system-security-plan-resource"
                    label="that is correct" />
            </x:scenario>
            <x:scenario
                label="and the SSP is not declared as a back-matter resource">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <import-ssp
                            href="#bf974aa0-d662-4aef-a7a5-8f4cce398746" />
                        <back-matter>
                            <!-- missing resource -->
                        </back-matter>
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="has-system-security-plan-resource"
                    label="that is an error" />
            </x:scenario>
        </x:scenario>

        <x:scenario
            label="when there is a system-security-plan resource">

            <x:scenario
                label="and it has one and only one rlink">
                <x:expect-not-assert
                    id="has-ssp-rlink"
                    label="that is correct" />
            </x:scenario>

            <x:scenario
                label="and it lacks an rlink">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <import-ssp
                            href="#bf974aa0-d662-4aef-a7a5-8f4cce398746" />
                        <back-matter>
                            <resource
                                uuid="bf974aa0-d662-4aef-a7a5-8f4cce398746">
                                <title>System Security Plan</title>
                                <prop
                                    name="type"
                                    value="system-security-plan" />
                                <!-- missing rlink -->
                            </resource>
                        </back-matter>
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="has-ssp-rlink"
                    label="that is an error" />
            </x:scenario>

            <x:scenario
                label="and it has more than one one rlink">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <import-ssp
                            href="#bf974aa0-d662-4aef-a7a5-8f4cce398746" />
                        <back-matter>
                            <resource
                                uuid="bf974aa0-d662-4aef-a7a5-8f4cce398746">
                                <title>System Security Plan</title>
                                <prop
                                    name="type"
                                    value="system-security-plan" />
                                <rlink
                                    href="../../../../dist/content/templates/ssp/xml/FedRAMP-SSP-OSCAL-Template.xml"
                                    media-type="text/xml" />
                                <rlink
                                    href="../../../../dist/content/templates/ssp/json/FedRAMP-SSP-OSCAL-Template.json"
                                    media-type="application/json" />
                            </resource>
                        </back-matter>
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="has-ssp-rlink"
                    label="that is an error" />
            </x:scenario>

            <x:scenario
                label="and the rlink has an allowed media-type">
                <x:expect-not-assert
                    id="has-acceptable-system-security-plan-rlink-media-type"
                    label="that is correct" />
            </x:scenario>
            <x:scenario
                label="and the rlink lacks an allowed media-type">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <import-ssp
                            href="#bf974aa0-d662-4aef-a7a5-8f4cce398746" />
                        <back-matter>
                            <resource
                                uuid="bf974aa0-d662-4aef-a7a5-8f4cce398746">
                                <title>System Security Plan</title>
                                <prop
                                    name="type"
                                    value="system-security-plan" />
                                <rlink
                                    href="../../../../dist/content/templates/ssp/xml/FedRAMP-SSP-OSCAL-Template.xml"
                                    media-type="text/markdown" />
                            </resource>
                        </back-matter>
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="has-acceptable-system-security-plan-rlink-media-type"
                    label="that is an error" />
            </x:scenario>

            <x:scenario
                label="and it lacks a base64">
                <x:expect-not-assert
                    id="has-no-base64"
                    label="that is correct" />
            </x:scenario>

            <x:scenario
                label="and it has a base64">
                <x:context>
                    <plan-of-action-and-milestones
                        xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                        <import-ssp
                            href="#bf974aa0-d662-4aef-a7a5-8f4cce398746" />
                        <back-matter>
                            <resource
                                uuid="bf974aa0-d662-4aef-a7a5-8f4cce398746">
                                <title>System Security Plan</title>
                                <prop
                                    name="type"
                                    value="system-security-plan" />
                                <base64 />
                            </resource>
                        </back-matter>
                    </plan-of-action-and-milestones>
                </x:context>
                <x:expect-assert
                    id="has-no-base64"
                    label="that is an error" />
            </x:scenario>

        </x:scenario>

        <x:scenario
            label="when there is a no-oscal-ssp resource">
            <x:context>
                <plan-of-action-and-milestones
                    xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                    <import-ssp
                        href="#bf974aa0-d662-4aef-a7a5-8f4cce398746" />
                    <back-matter>
                        <resource
                            uuid="bf974aa0-d662-4aef-a7a5-8f4cce398746">
                            <title>System Security Plan</title>
                            <prop
                                name="type"
                                value="no-oscal-ssp" />
                        </resource>
                    </back-matter>
                </plan-of-action-and-milestones>
            </x:context>
            <x:expect-assert
                id="has-non-OSCAL-system-security-plan-resource"
                label="that should produce a warning" />
        </x:scenario>
        <x:scenario
            label="when there is not a no-oscal-ssp resource">
            <x:context>
                <plan-of-action-and-milestones
                    xmlns="http://csrc.nist.gov/ns/oscal/1.0">
                    <import-ssp
                        href="#bf974aa0-d662-4aef-a7a5-8f4cce398746" />
                    <back-matter>
                        <resource
                            uuid="bf974aa0-d662-4aef-a7a5-8f4cce398746">
                            <title>System Security Plan</title>
                            <!-- no no-oscal-ssp prop -->
                        </resource>
                    </back-matter>
                </plan-of-action-and-milestones>
            </x:context>
            <x:expect-not-assert
                id="has-non-OSCAL-system-security-plan-resource"
                label="that should produce no warning" />
        </x:scenario>
    </x:scenario>


</x:description>
